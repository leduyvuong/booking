<%= turbo_frame_tag dom_id(@time_slot, :booking) do %>
  <div class="mt-4 rounded-xl border border-green-200 bg-green-50 p-4">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-slate-900">Confirm your appointment</h3>
      <%= link_to "← Back to booking", new_appointment_path(time_slot_id: @time_slot.id), 
                  data: { turbo_frame: dom_id(@time_slot, :booking) },
                  class: "text-slate-500 hover:text-slate-700 text-sm font-medium" %>
    </div>
    
    <div class="space-y-6">
  <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
    <p class="text-xs font-semibold uppercase tracking-wide text-blue-600">Booking flow</p>
    <div class="mt-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3 text-sm font-semibold text-slate-500">
        <span class="flex h-9 w-9 items-center justify-center rounded-full bg-blue-600 text-white">1</span>
        Select doctor
      </div>
      <div class="flex items-center gap-3 text-sm font-semibold text-slate-500">
        <span class="flex h-9 w-9 items-center justify-center rounded-full bg-blue-600 text-white">2</span>
        Pick date &amp; time
      </div>
      <div class="flex items-center gap-3 text-sm font-semibold text-slate-500">
        <span class="flex h-9 w-9 items-center justify-center rounded-full bg-blue-600 text-white">3</span>
        Enter patient details
      </div>
      <div class="flex items-center gap-3 text-sm font-semibold text-slate-900">
        <span class="flex h-9 w-9 items-center justify-center rounded-full bg-blue-600 text-white ring-4 ring-blue-100">4</span>
        Review &amp; confirm
      </div>
    </div>
  </div>

  <% alert_message = flash.now[:alert] || flash[:alert] %>
  <% if alert_message.present? %>
    <div class="rounded-2xl border border-rose-200 bg-rose-50 p-4 text-sm text-rose-700">
      <p class="font-semibold"><%= alert_message %></p>
    </div>
  <% end %>

  <div class="grid gap-6 lg:grid-cols-[minmax(0,360px),1fr]">
    <div class="space-y-6">
      <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
        <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-400">Doctor</h2>
        <div class="mt-4 flex items-start gap-3">
          <div class="flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 text-base font-semibold text-blue-600">
            <%= @booking_form.doctor.name.split.map(&:first).join %>
          </div>
          <div class="space-y-1 text-sm text-slate-600">
            <p class="text-base font-semibold text-slate-800"><%= @booking_form.doctor.name %></p>
            <p class="font-medium text-blue-600"><%= @booking_form.doctor.specialty %></p>
            <p><%= @booking_form.clinic.name %></p>
            <p class="text-xs text-slate-500"><%= @booking_form.clinic.address %></p>
          </div>
        </div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
        <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-400">When</h2>
        <p class="mt-3 text-lg font-semibold text-slate-900">
          <%= @booking_form.time_slot.date.strftime('%A, %B %-d') %>
        </p>
        <p class="text-sm text-slate-600">
          <%= @booking_form.time_slot.start_time.strftime('%-I:%M %p') %> – <%= @booking_form.time_slot.end_time.strftime('%-I:%M %p') %>
        </p>
      </div>

      <div class="rounded-3xl border border-blue-200 bg-blue-50 p-5 text-sm text-blue-800">
        <p class="font-semibold">Please arrive 10 minutes before your appointment to complete any paperwork.</p>
      </div>
    </div>

    <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
      <h2 class="text-xl font-semibold text-slate-900">Review patient details</h2>
      <p class="mt-1 text-sm text-slate-500">Double-check the information below before completing your booking.</p>

      <dl class="mt-6 space-y-4 text-sm text-slate-600">
        <div>
          <dt class="text-xs font-semibold uppercase tracking-wide text-slate-400">Patient</dt>
          <dd class="mt-1 text-base font-semibold text-slate-800"><%= @booking_form.patient_name %></dd>
        </div>
        <div class="grid gap-4 sm:grid-cols-2">
          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-400">Phone</dt>
            <dd class="mt-1"><%= @booking_form.patient_phone %></dd>
          </div>
          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-400">Email</dt>
            <dd class="mt-1"><%= @booking_form.patient_email %></dd>
          </div>
        </div>
        <% if @booking_form.notes.present? %>
          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-400">Reason for visit</dt>
            <dd class="mt-1 whitespace-pre-line"><%= @booking_form.notes %></dd>
          </div>
        <% end %>
      </dl>

      <div class="mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-4 text-xs text-slate-500">
        By confirming, you agree to the clinic’s appointment policies. Cancellations can be made up to 24 hours in advance via your dashboard or by calling the clinic directly.
      </div>

      <%= form_with scope: :booking_form, url: appointments_path, method: :post, 
                    data: { turbo: "false" },
                    class: "mt-6 space-y-4" do |form| %>
        <%= form.hidden_field :time_slot_id, value: @booking_form.time_slot_id %>
        <%= form.hidden_field :patient_name, value: @booking_form.patient_name %>
        <%= form.hidden_field :patient_phone, value: @booking_form.patient_phone %>
        <%= form.hidden_field :patient_email, value: @booking_form.patient_email %>
        <%= form.hidden_field :notes, value: @booking_form.notes %>
        <%= form.hidden_field :terms_accepted, value: true %>

        <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
          <%= link_to "Edit information", new_appointment_path(time_slot_id: @booking_form.time_slot_id), 
                      data: { turbo_frame: dom_id(@time_slot, :booking) },
                      class: "text-sm font-semibold text-slate-500 hover:text-blue-600" %>
          <button type="submit"
                  class="inline-flex items-center justify-center rounded-full bg-blue-600 px-6 py-3 text-sm font-semibold text-white shadow hover:bg-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
            Confirm appointment
          </button>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
