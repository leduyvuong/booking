<%= turbo_frame_tag dom_id(@time_slot, :booking) do %>
  <div class="mt-4 rounded-xl border border-blue-200 bg-blue-50 p-4">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-slate-900">Book this appointment</h3>
      <%= link_to "Cancel", doctor_path(@time_slot.doctor), 
                  data: { turbo_frame: "_top" },
                  class: "text-slate-500 hover:text-slate-700 text-sm font-medium" %>
    </div>
    
    <div class="space-y-6">
  <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
    <p class="text-xs font-semibold uppercase tracking-wide text-blue-600">Booking flow</p>
    <div class="mt-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3 text-sm font-semibold text-slate-500">
        <span class="flex h-9 w-9 items-center justify-center rounded-full bg-blue-600 text-white">1</span>
        Select doctor
      </div>
      <div class="flex items-center gap-3 text-sm font-semibold text-slate-500">
        <span class="flex h-9 w-9 items-center justify-center rounded-full bg-blue-600 text-white">2</span>
        Pick date &amp; time
      </div>
      <div class="flex items-center gap-3 text-sm font-semibold text-slate-900">
        <span class="flex h-9 w-9 items-center justify-center rounded-full bg-blue-600 text-white ring-4 ring-blue-100">3</span>
        Enter patient details
      </div>
      <div class="flex items-center gap-3 text-sm font-semibold text-slate-400">
        <span class="flex h-9 w-9 items-center justify-center rounded-full border border-slate-200">4</span>
        Review &amp; confirm
      </div>
    </div>
  </div>

  <% if @booking_form.errors.any? %>
    <div class="rounded-2xl border border-rose-200 bg-rose-50 p-4 text-sm text-rose-700">
      <p class="font-semibold">We couldn’t save your details yet:</p>
      <ul class="mt-2 list-disc space-y-1 pl-4">
        <% @booking_form.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="grid gap-6 lg:grid-cols-[minmax(0,360px),1fr]">
    <div class="space-y-6">
      <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
        <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-400">Appointment details</h2>
        <div class="mt-4 flex items-start gap-3">
          <div class="flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 text-base font-semibold text-blue-600">
            <%= @time_slot.doctor.name.split.map(&:first).join %>
          </div>
          <div class="space-y-1 text-sm text-slate-600">
            <p class="text-base font-semibold text-slate-800"><%= @time_slot.doctor.name %></p>
            <p class="font-medium text-blue-600"><%= @time_slot.doctor.specialty %></p>
            <p><%= @time_slot.date.strftime('%A, %B %-d') %> · <%= @time_slot.start_time.strftime('%-I:%M %p') %></p>
            <p><%= @time_slot.doctor.clinic.name %></p>
            <p class="text-xs text-slate-500">Address: <%= @time_slot.doctor.clinic.address %></p>
          </div>
        </div>
        <div class="mt-4 rounded-xl bg-slate-50 p-4 text-xs text-slate-500">
          <p><strong class="text-slate-700">Availability:</strong> <%= pluralize(@time_slot.available_slots, 'spot') %> remaining</p>
          <p class="mt-1"><strong class="text-slate-700">Booking #</strong> will be shared after confirmation.</p>
        </div>
      </div>
      <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm text-sm text-slate-600">
        <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-400">Need to reschedule?</h2>
        <p class="mt-2">You can manage upcoming bookings anytime from your <%= link_to "patient dashboard", my_appointments_path, class: "font-semibold text-blue-600" %>.</p>
      </div>
    </div>

    <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
      <h2 class="text-xl font-semibold text-slate-900">Patient information</h2>
      <p class="mt-1 text-sm text-slate-500">We’ll use these details to reach out with reminders and visit instructions.</p>

      <%= form_with model: @booking_form, scope: :booking_form, url: confirm_appointments_path, method: :post, 
                    local: false,
                    data: { turbo_frame: dom_id(@time_slot, :booking) },
                    class: "mt-6 space-y-5" do |form| %>
        <%= form.hidden_field :time_slot_id, value: @time_slot.id %>

        <div>
          <%= form.label :patient_name, "Full name", class: "block text-sm font-semibold text-slate-700" %>
          <%= form.text_field :patient_name, class: "mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200" %>
        </div>

        <div class="grid gap-4 sm:grid-cols-2">
          <div>
            <%= form.label :patient_phone, "Phone number", class: "block text-sm font-semibold text-slate-700" %>
            <%= form.telephone_field :patient_phone, class: "mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200" %>
          </div>
          <div>
            <%= form.label :patient_email, "Email", class: "block text-sm font-semibold text-slate-700" %>
            <%= form.email_field :patient_email, class: "mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200" %>
          </div>
        </div>

        <div>
          <%= form.label :notes, "Reason for visit", class: "block text-sm font-semibold text-slate-700" %>
          <%= form.text_area :notes, rows: 4, placeholder: "Tell us a bit about your symptoms or goals", class: "mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200" %>
        </div>

        <div class="flex items-start gap-3">
          <%= form.check_box :terms_accepted, class: "mt-1 h-5 w-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500" %>
          <label class="text-sm text-slate-600">
            I agree to the clinic’s <a href="#" class="font-semibold text-blue-600">terms &amp; privacy policy</a> and consent to receive appointment reminders.
          </label>
        </div>

        <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
          <%= link_to "Choose a different time", doctor_path(@time_slot.doctor), 
                      data: { turbo_frame: "_top" },
                      class: "text-sm font-semibold text-slate-500 hover:text-blue-600" %>
          <button type="submit" class="inline-flex items-center justify-center rounded-full bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
            Continue to review
          </button>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
